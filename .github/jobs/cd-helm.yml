parameters:
  name: ""
  subscription: ""
  aksClusterName: ""
  aksResourceGroup: ""
  valueFile: ""
  TEST_ENV_VAR30: ""
  DATABASE_TEST: ""
  DATABASE_TEST40: ""

jobs:
  - job: ${{ parameters.name }}
    variables:
      TEST10: "value"
      Test_env_DB20: $(db-name)
      Test_env_DB30: "${{ parameters.DATABASE_TEST }}"
    steps:
      #
      # Deploy Helm Chart
      #
      - task: HelmInstaller@0
        displayName: "Install Helm 3.9.0"
        inputs:
          helmVersion: 3.9.0

      - task: HelmDeploy@0
        displayName: "Validate helm package"
        inputs:
          command: package
          chartPath: "helm"
          destination: "helm/dist"
          save: false

      - task: HelmDeploy@0
        displayName: "Deploy chart to cluster"
        inputs:
          azureSubscription: "${{ parameters.subscription }}"
          azureResourceGroup: "${{ parameters.aksResourceGroup }}"
          kubernetesCluster: "${{ parameters.aksClusterName }}"
          command: upgrade
          chartType: FilePath
          chartPath: "helm"
          releaseName: "transparency-engine"
          valueFile: "${{ parameters.valueFile }}"
          waitForExecution: false
